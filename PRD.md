国际化协作平台 PRD 文档
文档版本
版本号：1.0

更新日期：2023-10-20

作者：AI 产品顾问

1. 项目背景与目标
   1.1 背景
   当前项目国际化流程存在以下痛点：

运营侧：无法在页面上快速定位国际化 Key 对应的位置，反馈问题效率低。

开发侧：国际化 Key 与翻译文案通过 Excel 文件手动同步，协作流程割裂，易出错。

协作侧：缺乏统一平台管理多语言文案，版本混乱，无法追溯修改记录。

1.2 目标
构建一套全链路国际化协作平台，实现：

运营人员直接在页面上定位 Key 并反馈问题。

开发者自动化同步翻译文件，减少手动操作。

统一管理多语言文案，支持版本控制和协作审批。

2. 产品架构
   2.1 系统组成
   模块 描述
   浏览器插件 页面展示 Key 并提供反馈入口，关联上下文信息。
   CLI 工具 开发者通过命令行工具同步翻译文件，检测冲突和未翻译 Key。
   管理后台 集中管理 Key 和翻译文案，支持审批、版本控制、数据统计。
   2.2 架构图
   mermaid
   Copy
   graph TB
   subgraph 用户端
   A[浏览器插件] -->|提交反馈| B[管理后台]
   C[开发者 CLI] -->|同步数据| B
   end
   subgraph 管理后台
   B --> D[数据库]
   B --> E[审批流]
   B --> F[版本控制]
   end
3. 功能需求
   3.1 浏览器插件
   核心功能
   Key 可视化：

页面文案替换为 [key] 格式（如 [login.button]）。

悬浮展示原始文案、多语言翻译、代码路径。

反馈入口：

点击 Key 弹出反馈表单，支持填写问题描述、上传截图。

自动记录当前页面 URL 和环境（dev/prod）。

模式切换：

通过工具栏按钮一键切换「Key 模式」和「正常模式」。

技术实现
使用 MutationObserver 监听动态 DOM 变化，覆盖 SPA 应用。

通过 chrome.storage 缓存 Key 元数据，减少 API 请求。

3.2 CLI 工具
核心功能
同步翻译文件：

命令 i18n-cli sync：拉取最新翻译并合并到本地 locales/\*.json。

命令 i18n-cli push：扫描代码中的新 Key 并提交到管理后台。

冲突处理：

检测本地与管理后台的冲突修改，生成 conflicts.json 供人工处理。

未翻译 Key 检测：

在 pre-commit 钩子中检测未翻译 Key，阻止提交并输出警告。

技术实现
使用 Git Hooks（通过 husky 实现）自动化触发同步。

解析代码 AST（如 Babel）提取 t('key') 中的 Key。

3.3 管理后台
核心功能
Key 管理：

展示 Key 的关联上下文（页面 URL、截图、代码路径）。

支持批量导入/导出 Excel（兼容旧流程）。

协作审批：

运营提交修改 → 项目经理审批 → 自动同步到代码仓库。

版本控制：

保存历史版本，支持差异对比和回滚。

数据统计：

报表展示未翻译 Key 数量、高频修改 Key 等。

技术实现
后端 API：Golang + Gin + MySQL（存储 Key 和翻译关系）。

前端：React + Vite + Ant Design。

4. 用户流程
   4.1 运营反馈流程
   mermaid
   Copy
   sequenceDiagram
   运营->>浏览器插件: 点击 Key 提交反馈
   浏览器插件->>管理后台: 发送 Key/截图/URL
   管理后台->>项目经理: 通知审批
   项目经理->>管理后台: 批准修改
   管理后台->>CLI 工具: 触发同步（Webhook）
   CLI 工具->>开发者: 拉取更新并合并
   4.2 开发者同步流程
   mermaid
   Copy
   sequenceDiagram
   开发者->>CLI 工具: 执行 i18n-cli sync
   CLI 工具->>管理后台: 请求最新翻译
   管理后台-->>CLI 工具: 返回 JSON 数据
   CLI 工具->>本地文件: 合并并解决冲突
   CLI 工具->>开发者: 输出变更日志
5. 非功能性需求
   5.1 性能
   浏览器插件 DOM 替换延迟 < 100ms（针对 10,000 个节点）。

CLI 工具同步耗时 < 5s（1,000 个 Key 场景）。

5.2 安全性
API 通信使用 HTTPS + JWT 鉴权。

数据库敏感信息加密存储（如 MySQL 加密函数）。

5.3 兼容性
浏览器插件支持 Chrome/Firefox。

CLI 工具支持 macOS/Linux/Windows。

6. 开发计划
   6.1 MVP 阶段（4 周）
   模块 交付内容
   浏览器插件 Key 展示、反馈表单、模式切换
   管理后台 Key 增删改查、基础审批流
   CLI 工具 同步命令、冲突检测
   6.2 二期优化（2 周）
   浏览器插件：截图标注工具、反馈工单状态追踪。

管理后台：数据统计面板、GitLab CI 集成。

7. 风险与应对
   风险 应对方案
   浏览器插件性能影响页面交互 限制 MutationObserver 监听范围，优化 DOM 操作
   冲突合并逻辑复杂 提供可视化冲突解决工具（如对比 Diff）
   运营人员不愿使用新工具 提供培训文档，保留 Excel 导入导出功能
8. 成功指标
   运营效率：反馈问题处理周期缩短 50%。

开发效率：手动同步翻译文件时间减少 90%。

数据质量：未翻译 Key 数量下降至 0。

附录

交互原型：Figma 链接（需补充）

API 文档：Swagger 链接（需补充）
